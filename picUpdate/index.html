<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        list-style-type: none;
      }
      h2::after {
        content: "";
        width: 500px;
        height: 2px;
        background: #ccc;
        position: absolute;
        top: 15px;
        left: 50px;
      }
    </style>
  </head>
  <body>
    <h2>标题</h2>
    <input type="file" />
    <canvas width="600" height="600" id="myCanvas"></canvas>
    <img id="img" src="" alt="" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      var inp = document.querySelector("input");

      //文件上传
      /** inp.onchange = function(e) {
              let files = e.target.files;
              //创建formData
              let form = new FormData();
              for (let i = 0, len = files.length; i < len; i++) {
                form.append(files[i].name, files[i]);
              }

              axios({
                method: "post",
                url: "http://123.206.55.50:11000/upload",
                data: form
              })
                .then(body => {
                  let img = new Image();
                  img.src = body.data.data[0].path;
                  document.body.append(img)
                })
                .catch(e => {
                  console.log("e..", e);
                });
            };**/

      //base64图片上传
      /** inp.onchange = function(e) {
              let files = e.target.files;
              var reader = new FileReader();
              reader.onload = function() {
                axios({
                  method: "post",
                  url: "http://123.206.55.50:11000/upload_base64",
                  data: { base64: this.result }
                })
                  .then(body => {
                    let img = new Image();
                    img.src = this.result;
                    document.body.append(img);
                  })
                  .catch(e => {
                    console.log("e..", e);
                  });
              };
              reader.readAsDataURL(files[0]);
            };**/

      //合成图片
      /* function drawImg(bgimg, img) {
        //背景图片，上面图，文字
        var canvas = document.createElement("canvas");
        canvas.width = 300;
        canvas.height = 300;
        var context = canvas.getContext("2d");

        context.rect(0, 0, canvas.width, canvas.height);
        context.fillStyle = "#fff";
        context.fill();

        var myImage = new Image();
        myImage.src = bgimg;
        myImage.crossOrigin = "Anonymous";

        myImage.onload = function() {
          context.drawImage(myImage, 0, 0, 300, 300);
          var myImage2 = new Image();
          myImage2.src = img;
          myImage2.crossOrigin = "Anonymous";

          myImage2.onload = function() {
            context.drawImage(myImage2, 110, 60, 80, 80);
            var base64 = canvas.toDataURL("image/jpg");
            var img = document.getElementById("img");
            img.setAttribute("src", base64);
          };
        };
      }
      drawImg("./5.jpg", "./4.jpg");*/

      //图片合成
      /* var canvas = document.createElement("canvas");
     var ctx = canvas.getContext("2d");

     //1.设置画布的高度
     canvas.width = 600;
     canvas.height = 600;

     //2.绘制背景图
     var img = new Image();
     axios({
       method:"post",
       url:"http://123.206.55.50:11000/tobase64",
       data:{url:"https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1486513396,554854054&fm=27&gp=0.jpg"}
     }).then(body=>{
       console.log("body...",body)
       img.src = body.data.data.base64
     }).catch(e=>{
       console("e...",e)
     })

     img.onload = function(){
       ctx.drawImage(img,0,0,600,600)
     }

     //3.监听图片上传
     inp.onchange = function(e){
       let files = e.target.files;
       //创建一个fileReader
       for(let i=0,len = files.length;i<len;i++){
         var reader =  new FileReader();
         reader.onload = function(){
           //绘制上传图片
           var avatar =  new Image();
           avatar.src = this.result;
           avatar.onload = function(){
             ctx.drawImage(avatar,render(100,150),render(150,200),100,100);

              // 5.合成一张图片
              var result = canvas.toDataURL('jpg', 0.8);
              // console.log('result...', result);
              var imgs = new Image()
              imgs.src = result;
              document.body.append(imgs);
           }
         }
         reader.readAsDataURL(files[i])
       }
     }

     function render(min,max){
       return Math.floor(Math.random()*(max-min-1)+min)
     }*/
    </script>
  </body>
</html>
